<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checklist 7 errori — Federica Cellini</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{ --navy:#0A2540; --gold:#D4AF37; --gold-2:#E2BF56; --text:#1C1C1C; --muted:#555; --bg:#FAFAFA; --radius:14px; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .container{max-width:520px;margin:64px auto;background:#fff;padding:28px;border-radius:var(--radius);box-shadow:0 6px 24px rgba(10,37,64,.08)}
    h1{margin:0 0 8px;font-size:24px;font-weight:800;color:var(--navy);text-align:center}
    p.lead{margin:0 0 22px;color:var(--muted);font-size:15px;text-align:center}
    label{display:block;font-size:14px;font-weight:600;margin:14px 0 6px}
    input,select{width:100%;padding:12px 14px;border:1px solid #e6e6e6;border-radius:12px;font-size:15px;background:#fff}
    input:focus,select:focus{border-color:#cbd5e1;box-shadow:0 0 0 3px rgba(58,124,165,.12);outline:none}
    button{width:100%;margin-top:10px;padding:14px;border:0;border-radius:12px;cursor:pointer;background:var(--gold);color:var(--navy);font-weight:800;font-size:16px;transition:background .15s ease,transform .02s ease}
    button:hover{background:var(--gold-2)}
    .success{display:none;margin-top:14px;padding:12px;border-radius:12px;text-align:center;background:#e8f7ef;color:#0a6b2b;font-weight:600;font-size:14px}
    .err{color:#b00020;font-size:13px;margin-top:6px;display:none}
  </style>
</head>
<body>
  <div class="container">
    <h1>Scarica la checklist</h1>
    <p class="lead">Compila i campi per ricevere la <b>Checklist: 7 errori che fanno perdere prenotazioni</b>.</p>

    <form id="leadForm" novalidate>
      <label for="name">Nome</label>
      <input id="name" name="name" type="text" placeholder="Inserisci il tuo nome" required />

      <label for="email">Email</label>
      <input id="email" name="email" type="email" placeholder="es. nome@email.com" required />

      <label for="phone">Telefono</label>
      <input id="phone" name="phone" type="tel" placeholder="+39 3xx xxx xxxx" required />

      <label for="situazione">Situazione</label>
      <select id="situazione" name="situazione" required>
        <option value="">Seleziona…</option>
        <option value="Ho già una casa vacanza">Ho già una casa vacanza</option>
        <option value="Sto per iniziare">Sto per iniziare</option>
        <option value="Gestisco per altri">Gestisco per altri</option>
      </select>

      <button type="submit" id="submitBtn">Invia e scarica la checklist</button>
      <div class="success" id="successMsg">Dati inviati! Reindirizzamento…</div>
      <div class="err" id="errMsg">Errore di rete. Riprova tra poco.</div>
    </form>
  </div>

  <script>
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbysELmr4ZOvglHJfEplkkO0E8mW1oDfZUbhkQ2mzHo0vJp4f0npo50SNz8NLGwL-SwZNA/exec";
    const TIPOLOGIA = "errori";
    const REDIRECT = "https://federicapropertymanager.github.io/checklisterrori/errori/";

    const params = new URLSearchParams(location.search);
    const utm_source = params.get('utm_source') || 'instagram';
    const utm_medium = params.get('utm_medium') || '';
    const utm_campaign = params.get('utm_campaign') || TIPOLOGIA;

    const isEmail = v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);

    document.getElementById("leadForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const btn = document.getElementById("submitBtn");
      const ok = document.getElementById("successMsg");
      const err = document.getElementById("errMsg");
      err.style.display = "none";

      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const situazione = document.getElementById("situazione").value;

      if (!name || !isEmail(email) || !phone || !situazione) {
        err.textContent = "Compila tutti i campi.";
        err.style.display = "block";
        return;
      }

      btn.disabled = true; btn.textContent = "Invio in corso…";

      const payload = {
        name, email, phone, situazione,
        tipologia: TIPOLOGIA,
        provenienza: utm_source,
        utm_source, utm_medium, utm_campaign,
        ts: new Date().toISOString()
      };

      try {
        if (navigator.sendBeacon) {
          const blob = new Blob([JSON.stringify(payload)], { type: "text/plain" });
          navigator.sendBeacon(ENDPOINT, blob);
          window.location.href = REDIRECT;
          return;
        }
        await fetch(ENDPOINT, { method:"POST", mode:"no-cors", headers:{ "Content-Type":"text/plain" }, body: JSON.stringify(payload) });
        ok.style.display = "block";
        setTimeout(()=> window.location.href = REDIRECT, 300);
      } catch {
        err.textContent = "Errore di rete."; err.style.display = "block";
        btn.disabled = false; btn.textContent = "Invia e scarica la checklist";
      }
    });
  </script>
</body>
</html>
